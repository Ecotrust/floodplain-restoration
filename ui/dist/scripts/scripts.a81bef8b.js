function resize(){var a=$(window).height(),b=$(window).width(),c=$(window).width();map.onResize(a,b),c>991?(leftPanelResize(a,b),bodyResize(a,b)):$("#map-container").is(":visible")||leftPanelResize(a,b)}function bodyResize(){$("body").css("padding-top",parseInt($("#main-navbar").css("height")))}function leftPanelResize(a){$(".left-panel-column").height(a-53)}function buildMap(a,b){var c={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[{type:"Feature",geometry:a}]};site.style=function(){return[new ol.style.Style({stroke:new ol.style.Stroke({color:"white",lineDash:[4],width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})]},site.source=new ol.source.GeoJSON({object:c});for(var d=0;d<b.length;d++){var e=b[d];pitsGeoJson.features.push({type:"Feature",geometry:e.geometry,properties:{pk:e.id,id:e.id,name:e.properties.name,score:e.properties.score.value}})}site.layer=new ol.layer.Vector({source:site.source,style:site.style}),pits.style=function(a){return[new ol.style.Style({stroke:new ol.style.Stroke({color:"#F15A24",width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0)"}),text:new ol.style.Text({text:a.get("name"),font:"12px Calibri,sans-serif",stroke:new ol.style.Stroke({color:"#fff",width:3}),fill:new ol.style.Fill({color:"#000"})})})]},pits.source=new ol.source.GeoJSON({object:pitsGeoJson}),pits.layer=new ol.layer.Vector({source:pits.source,style:pits.style});var f=site.source.getExtent();rmap=new ol.Map({target:"report-map",layers:[new ol.layer.Group({title:"Base maps",layers:[new ol.layer.Tile({visible:!0,title:"Satellite",type:"base",source:new ol.source.MapQuest({layer:"sat"})}),site.layer,pits.layer]})],view:new ol.View({center:ol.proj.transform([-122,44],"EPSG:4326","EPSG:3857"),zoom:7})}),rmap.getView().fitExtent(f,rmap.getSize())}var dummydata={type:"FeatureCollection",features:[{geometry:{type:"MultiPolygon",coordinates:[[[[-13693239.7724,5469069.373804],[-13693234.99512,5468730.184491],[-13693163.3354,5468687.188663],[-13692972.242835,5468701.52061],[-13692824.1461,5468610.751635],[-13692661.7174,5468539.091921],[-13692487.3454,5468326.50144],[-13691942.73161,5468297.83755],[-13691534.2712,5468176.016036],[-13690889.333814,5467896.54315],[-13690526.2579,5467552.57652],[-13690330.388,5469446.78163],[-13690509.5373,5469635.485545],[-13690521.4806,5469752.529745],[-13690612.2496,5469833.744087],[-13690951.4389,5469852.85334],[-13692045.4439,5469623.542259],[-13692570.9484,5469465.890889],[-13693010.4613,5469217.47055],[-13693239.7724,5469069.373804]]]]},type:"Feature",id:4,properties:{inputnode_set:[{name:"",date_modified:"2014-10-16T23:33:42.749Z",notes:"",question:1,site:4,value:.3,user:"dummyuser",date_created:"2014-10-16T23:33:42.749Z",id:4}],name:"Willamette Confluence",date_modified:"2014-10-16T23:33:42.686Z",notes:"Notes on Location",user:"dummyuser",date_created:"2014-10-16T23:33:42.686Z",shared_with_public:!1,pit_set:[{geometry:{type:"Polygon",coordinates:[[[-13692100.382981,5469387.0652],[-13691854.351296,5469513.66403],[-13691742.084411,5469535.161945],[-13691715.8092,5469508.886717],[-13691653.704097,5469516.05269],[-13691529.4939,5469461.113574],[-13691295.4055,5469442.00432],[-13690975.325471,5469527.99597],[-13690836.7834,5469523.21866],[-13690841.560671,5469432.44969],[-13692040.6666,5469227.025175],[-13692102.771638,5469317.794146],[-13692100.382981,5469387.0652]]]},type:"Feature",id:6,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.695Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:4,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.695Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}},{geometry:{type:"Polygon",coordinates:[[[-13691245.243727,5469207.915918],[-13691008.766671,5469260.46637],[-13691011.1553,5469303.4622],[-13690796.176186,5469339.29206],[-13690774.6783,5469193.583975],[-13691202.2479,5469102.815004],[-13691245.243727,5469207.915918]]]},type:"Feature",id:7,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.706Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:4,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.706Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}},{geometry:{type:"Polygon",coordinates:[[[-13691880.626525,5469081.31709],[-13691574.878412,5469141.03352],[-13691584.43304,5469195.972632],[-13691281.073584,5469243.745775],[-13691250.021041,5469090.87172],[-13691856.739953,5468969.0502],[-13691880.626525,5469081.31709]]]},type:"Feature",id:8,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.724Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:4,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.724Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}},{geometry:{type:"Polygon",coordinates:[[[-13690836.7834,5469568.60314],[-13690800.9535,5469809.857516],[-13690917.9977,5469821.8008],[-13691457.8342,5469711.922573],[-13691484.10944,5469664.149431],[-13691517.55064,5469659.372116],[-13691562.935126,5469692.81332],[-13692315.3621,5469525.60732],[-13692544.673208,5469442.00432],[-13692585.2804,5469384.676546],[-13692613.944265,5469315.40549],[-13692504.066,5469291.518918],[-13692482.5681,5469315.40549],[-13692499.2887,5469329.737432],[-13692527.952608,5469320.182803],[-13692568.559779,5469334.514746],[-13692511.232008,5469372.73326],[-13692487.3454,5469396.61983],[-13692430.017665,5469358.40132],[-13692363.135266,5469367.955946],[-13692315.3621,5469332.126089],[-13692207.8726,5469377.510575],[-13692315.3621,5469399.00849],[-13692265.200323,5469418.117746],[-13692186.374638,5469391.84252],[-13692019.168638,5469511.27537],[-13691990.5048,5469487.388803],[-13691921.233696,5469535.161945],[-13691887.7925,5469523.21866],[-13691744.473068,5469590.10106],[-13691737.3071,5469563.825831],[-13691711.0319,5469563.825831],[-13691706.2546,5469606.82166],[-13691682.367983,5469602.04434],[-13691684.75664,5469575.76912],[-13691632.2062,5469559.04852],[-13691584.43304,5469508.886717],[-13691417.227041,5469475.44552],[-13691271.519,5469492.166117],[-13691147.308785,5469525.60732],[-13690992.046071,5469578.157774],[-13690939.4956,5469611.59897],[-13690922.775014,5469585.323745],[-13690875.0019,5469585.323745],[-13690853.504,5469575.76912],[-13690836.7834,5469568.60314]]]},type:"Feature",id:9,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.738Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:4,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.738Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}}]}},{geometry:{type:"MultiPolygon",coordinates:[[[[-13688321.527395,5468904.556462],[-13687889.180454,5469078.928433],[-13687557.157112,5469138.64486],[-13687275.2956,5469143.42218],[-13686916.997,5468971.438862],[-13686862.057886,5468880.66989],[-13687277.6842,5468601.197006],[-13687664.646683,5468307.392179],[-13688240.313053,5468694.35463],[-13688321.527395,5468904.556462]]]]},type:"Feature",id:5,properties:{inputnode_set:[{name:"",date_modified:"2014-10-16T23:33:42.790Z",notes:"",question:1,site:5,value:.3,user:"dummyuser",date_created:"2014-10-16T23:33:42.790Z",id:5}],name:"Location Two",date_modified:"2014-10-16T23:33:42.763Z",notes:"Notes on Location",user:"dummyuser",date_created:"2014-10-16T23:33:42.763Z",shared_with_public:!1,pit_set:[{geometry:{type:"Polygon",coordinates:[[[-13687518.9386,5468961.88423],[-13687526.1046,5468844.840034],[-13687483.108741,5468739.73912],[-13687246.6317,5468754.07106],[-13687005.3773,5468909.33378],[-13687244.243,5469007.26872],[-13687518.9386,5468961.88423]]]},type:"Feature",id:10,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.771Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:5,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.771Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}},{geometry:{type:"Polygon",coordinates:[[[-13688039.6659,5468890.224519],[-13687860.5166,5469019.212],[-13687812.743426,5469007.26872],[-13687772.136254,5468942.774976],[-13687941.7309,5468871.11526],[-13688018.1679,5468868.726605],[-13688039.6659,5468890.224519]]]},type:"Feature",id:11,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.780Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:5,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.780Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}}]}},{geometry:{type:"MultiPolygon",coordinates:[[[[-13711567.9386,5505914.41009],[-13711197.696767,5505928.742038],[-13711190.530795,5504970.89053],[-13711233.526624,5504775.020642],[-13711802.027022,5504056.034845],[-13712160.325592,5504438.219986],[-13712141.216335,5504975.66784],[-13712007.4515,5505107.043984],[-13711735.1446,5505338.743726],[-13711589.4365,5505673.155724],[-13711567.9386,5505914.41009]]]]},type:"Feature",id:6,properties:{inputnode_set:[{name:"",date_modified:"2014-10-16T23:33:42.835Z",notes:"",question:1,site:6,value:.3,user:"dummyuser",date_created:"2014-10-16T23:33:42.835Z",id:6}],name:"Location 3",date_modified:"2014-10-16T23:33:42.798Z",notes:"Notes on Location",user:"dummyuser",date_created:"2014-10-16T23:33:42.798Z",shared_with_public:!1,pit_set:[{geometry:{type:"Polygon",coordinates:[[[-13711496.3,5505601.5],[-13711238.3,5505546.6],[-13711219.2,5505484.5],[-13711212,5504968.5],[-13711269.4,5504978.1],[-13711300.4,5504961.3],[-13711481.9,5505011.5],[-13711474.8,5505267.1],[-13711465.2,5505427.1],[-13711503.4,5505458.2],[-13711496.3,5505601.5]]]},type:"Feature",id:12,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.810Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:6,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.810Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}},{geometry:{type:"Polygon",coordinates:[[[-13711638.4,5504712.9],[-13711571.5,5504673.5],[-13711585.9,5504648.4],[-13711668.3,5504697.4],[-13711619.3,5504809.7],[-13711558.4,5504901.6],[-13711538.1,5504905.2],[-13711510.6,5504930.3],[-13711497.5,5504962.5],[-13711400.7,5504937.4],[-13711400.7,5504905.2],[-13711437.8,5504882.5],[-13711472.4,5504789.4],[-13711578.7,5504830],[-13711638.4,5504712.9]]]},type:"Feature",id:13,properties:{surface_area:.5,substrate:.5,name:"testpit",date_modified:"2014-10-16T23:33:42.821Z",pit_depth:.5,notes:"",adjacent_river_depth:.5,site:6,complexity:.5,user:"dummyuser",contamination:.5,date_created:"2014-10-16T23:33:42.821Z",slope_dist:.5,bank_slope:.5,pit_levies:.5,bedrock:.5}}]}}]};angular.module("uiApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.xsrfHeaderName="X-CSRFToken",b.defaults.xsrfCookieName="csrftoken",a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/sites",{templateUrl:"views/sitelist.html",controller:"SitelistCtrl"}).when("/site/new",{templateUrl:"views/siteedit.html",controller:"SiteeditCtrl"}).when("/site/:siteId",{templateUrl:"views/sitedetail.html",controller:"SitedetailCtrl"}).when("/site/:siteId/edit",{templateUrl:"views/siteedit.html",controller:"SiteeditCtrl"}).when("/site/:siteId/pit/new",{templateUrl:"views/pitedit.html",controller:"PiteditCtrl"}).when("/site/:siteId/pit/:pitId/edit",{templateUrl:"views/pitedit.html",controller:"PiteditCtrl"}).when("/site/:siteId/survey/done",{templateUrl:"views/surveydone.html",controller:"SurveydoneCtrl"}).when("/site/:siteId/survey/:questionId",{templateUrl:"views/survey.html",controller:"SurveyCtrl"}).when("/site/:siteId/report",{templateUrl:"views/report.html",controller:"ReportCtrl"}).when("/help/:topic",{templateUrl:"views/help.html",controller:"HelpCtrl"}).otherwise({templateUrl:"404.html"})}]).run(["$rootScope","ContentFactory",function(a,b){a.content=b.initialContent(),b.allContent().then(function(){a.content=b.content})}]);var map;angular.module("uiApp").factory("SiteFactory",["$rootScope","$http","$window",function(a,b,c){var d={};return d.sites=[],d.suitability={},d.getSites=function(){var a=b.get("/api/site.json");return a.success(function(a){d.sites=a}),a.error(function(){console.log("Could not fetch sites.json")}),a},d.deleteSite=function(a){var c="/api/site/"+a,e=b["delete"](c);return e.success(function(){for(var b=d.sites.features.length-1;b>=0;b--){var c=d.sites.features[b];c.id===a&&d.sites.features.splice(b,1)}}),e.error(function(){console.log("Could not DELETE",c)}),e},d.deleteSitePit=function(a,c){for(var e,f="/api/pit/"+c,g=d.sites.features.length-1;g>=0;g--){var h=d.sites.features[g];h.id===a&&(e=g)}var i=b["delete"](f);return i.success(function(){for(var a=d.sites.features[e].properties.pit_set.length-1;a>=0;a--){var b=d.sites.features[e].properties.pit_set[a];b.id===c&&d.sites.features[e].properties.pit_set.splice(a,1)}}),i},d.postSite=function(a,d){var e="/api/site";a.geometry=d;var f=b.post(e,a);return f.success(function(){}),f.error(function(a){console.log("ERROR",a),c.alert("Could not create new site. Be sure you have all required fields filled in.")}),f},d.postSitePit=function(a,d,e){var f="/api/pit";d.geometry=e;var g=b.post(f,d);return g.success(function(){}),g.error(function(a){console.log("ERROR",a),c.alert("Could not create new pit. Be sure you have all required fields filled in.")}),g},d.putSite=function(a,d){var e="/api/site/"+a.id;a.geometry=d;var f=b.put(e,a);return f.success(function(){}),f.error(function(a){console.log("ERROR",a),c.alert("Could not update site. Be sure you have all required fields filled in.")}),f},d.publicizeSite=function(a,d){var e="/api/site/"+a.id;a.properties.shared_with_public=d;var f=b.put(e,a);return f.success(function(){}),f.error(function(a){console.log("ERROR",a),c.alert("Could not publicize site. Be sure you are logged in and have permission to do so.")}),f},d.putSitePit=function(a,d,e){var f="/api/pit/"+d.id;d.geometry=e;var g=b.put(f,d);return g.success(function(){}),g.error(function(a){console.log("ERROR",a),c.alert("Could not update pit. Be sure you have all required fields filled in.")}),g},d.getSuitabilityScores=function(a){var c="/api/site/"+a+"/suitability.json",e=b.get(c);return e.success(function(a){d.suitability=a}),e.error(function(){console.log("Could not fetch suitability.json")}),e},d.geosearch=function(a){var c="/geosearch/search/?search="+a,d=b.get(c);return d.success(function(a){map.geosearchZoom(a.extent)}),d.error(function(a){window.alert('Site "'+a.search+'" not found.')}),d},d}]),angular.module("uiApp").factory("QuestionFactory",["$http",function(a){var b={};return b.questions=[],b.categories=[],b.contexts=[],b.getQuestions=function(){var c=a.get("/api/questions.json");return c.success(function(a){a.sort(function(a,b){return a.order-b.order}),b.questions=a}),c.error(function(){console.log("Could not fetch questions.json")}),c},b.getCategories=function(){var c=a.get("/api/categories.json");return c.success(function(a){b.categories=a}),c.error(function(){console.log("Could not fetch categories.")}),c},b.getContexts=function(){var c=a.get("/api/contexts.json");return c.success(function(a){b.contexts=a}),c.error(function(){console.log("Could not fetch contexts.")}),c},b}]),angular.module("uiApp").factory("ContentFactory",["$http",function(a){var b={};return b.content={about:"We are building an online tool that provides an efficient and sound approach to quickly identify whether restoring a former gravel pit mine site is worth the investment of time and money.",title:"Floodplain Gravel Mine Restoration",welcome:"The Floodplain Gravel Mine Restoration Tool",hook:"Informed decision making and resource investment <br> for the restoration of floodplain mining sites.",requirements:'<a class="homepage-link" href="#/help/documents">Before you get started</a>',getStarted:"Get Started",siteListHeader:"All Sites",siteCreateDirections:"Click anywhere on the map to start defining your general site boundary. <br/><br/> Continue clicking to complete the shape of your site. <br/><br/> When you're satisfied with your site outline, double-click to end drawing.<br/><br/> Name and save your site when done. You can come back and edit this at any time.",siteEditDirections:"Click and hold anywhere on the site border to grab it. <br/><br/> Drag the section of border to where it belongs.",siteEditDefinitions:'<div class="definition-block blue-text"><p><span class="definition-term">Site</span>: A contiguous plot of land that encompasses one or more pits.</p><p><span class="definition-term">Pit</span>: A single gravel pit mine.</p></div>',pitCreateDirections:"Like drawing your site, click once on the map to begin drawing your pit boundaries. Click again to add additional points. Double-click to finish.",pitDisclaimer:"ONLY include pits will be part of this restoration.",pitEditDirections:"Click and hold anywhere on the pit border to grab it. Drag the section of the border to where it belongs.",previousQuestion:"<< Previous Question",attribution:"This tool is a product of The Nature Conservancy and Ecotrust",mainPhotoAttribution:"Photo © Melissa Olson/TNC",documents:'        <h3>Before you get started...</h3>        <h4>Please assemble as many of the following resources as possible:</h4>        <div class="table-container">          <div class="table-row">            <div class="table-cell col-md-12">              <div class="property-box padded-box">                <p class="blue-text document-list-item">Taxlot, land user, easement, access, infrastructure, and other relevant site information.</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">Any information on existing permits or pit reclaimation requirements</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">Existing conservation plans, recovery plans, prioritizations, regional priorities</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">Water rights information</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">State environment or water quality information</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">Watershed assessments, sediment budgets, and other available watershed or river research, reports, or data</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">Ecological assessments, research, reports, or data on species and habitat in the watershed, the reach, or on the site</p>                <hr class="document-list-hr">                <p class="blue-text document-list-item">Reasonable estimates of both pit depth and river thalweg</p>              </div>            </div>            <div class="col-md-1 table-cell survey-nav-col">              <a href="#/">                <p class="survey-nav survey-nav-forward">                  <span class="glyphicon glyphicon-play survey-nav-icon"></span>                </p>              </a>            </div>'},b.initialContent=function(){return b.content},b.allContent=function(){var c=a.get("/api/content.json");return c.success(function(a){for(var c=0;c<a.length;c++)b.content[a[c].slug]=a[c].content}),c.error(function(){console.log("Could not fetch content.json")}),c},b.getContent=function(a){return b.content[a]},b.get=function(a){return this.getContent(a)},b}]),angular.module("uiApp").config(["$httpProvider",function(a){a.responseInterceptors.push("myHttpInterceptor");var b=function(a){return a};a.defaults.transformRequest.push(b)}]).factory("myHttpInterceptor",["$q","$window",function(a){return function(b){return b.then(function(a){return window.setTimeout(resize,1),a},function(b){return window.setTimeout(resize,1),a.reject(b)})}}]);var map;angular.module("uiApp").controller("MainCtrl",["$scope","$rootScope","$sce","ContentFactory",function(a,b,c,d){b.activeSiteId=null,map.showMap(!1),a.attribution=c.trustAsHtml(d.get("attribution"))}]);var map;angular.module("uiApp").controller("SitelistCtrl",["$scope","$rootScope","$window","SiteFactory","QuestionFactory","NodeFactory",function(a,b,c,d,e,f){function g(b){f.getNodes(a.sites[b].id).then(function(){a.sites[b].nodeCount=f.nodes.length})}b.userName||(c.alert("You are not logged in. You will now be redirected to the login page."),c.location="/accounts/login/"),map.showMap(!0),a.sites=[],b.activeSiteId=null,a.numQuestions=0,d.getSites().then(function(){a.sites=d.sites.features,map.clear(),map.loadSites(d.sites),map.showMap(!0);for(var b in a.sites)g(b)}),e.getQuestions().then(function(){a.numQuestions=e.questions.length}),a.deleteSite=function(b){c.confirm("Delete this site? Are you sure?")===!0&&d.deleteSite(b).then(function(){a.sites=d.sites.features,map.clear(),map.loadSites(d.sites)})},a.toggleCircleIconClass=function(a){var b=document.getElementById(a);b.className=b.classList.contains("glyphicon-plus-sign")?b.className.replace(/\bglyphicon-plus-sign\b/,"glyphicon-minus-sign"):b.className.replace(/\bglyphicon-minus-sign\b/,"glyphicon-plus-sign")}}]);var map;angular.module("uiApp").controller("SitedetailCtrl",["$scope","$routeParams","$rootScope","$window","SiteFactory","QuestionFactory","NodeFactory",function(a,b,c,d,e,f,g){var h=parseInt(b.siteId,10);c.activeSiteId=h,c.userName||(d.alert("You are not logged in. You will now be redirected to the login page."),d.location="/accounts/login/"),map.showMap(!0),a.surveyPrompt="Begin Questions",a.sites=[],a.site={},a.firstUnansweredId=1;var i=1;e.getSites().then(function(){a.sites=e.sites.features;for(var b=e.sites.features.length-1;b>=0;b--){var c=e.sites.features[b];c.id===h&&(a.site=c)}map.clear(),map.loadSites({type:"FeatureCollection",features:[a.site]}),map.loadPits({type:"FeatureCollection",features:a.site.properties.pit_set}),map.showMap(!0)}),f.getQuestions().then(function(){a.questions=f.questions,a.questions.sort(function(a,b){return a.order-b.order}),a.firstUnansweredId=1,g.getNodes(c.activeSiteId).then(function(){var b=g.nodes;if(b.length>0){a.surveyPrompt="Continue Questions",a.showSummary=b.length>=i;for(var c in a.questions){var d=!1;for(var e in b)if(b[e].question===a.questions[c].id){d=!0;break}if(d===!1){a.firstUnansweredId=parseInt(c,10)+1;break}}}map.showMap(!0)})}),a.deleteSitePit=function(b,c){d.confirm("Delete this pit? Are you sure?")===!0&&e.deleteSitePit(b,c).then(function(){a.sites=e.sites.features;for(var b=e.sites.features.length-1;b>=0;b--){var c=e.sites.features[b];c.id===h&&(a.site=c)}map.loadPits({type:"FeatureCollection",features:a.site.properties.pit_set})})}}]);var map,OpenLayers;angular.module("uiApp").controller("SiteeditCtrl",["$scope","$routeParams","$location","$rootScope","$window","$sce","ContentFactory","SiteFactory",function(a,b,c,d,e,f,g,h){d.userName||(e.alert("You are not logged in. You will now be redirected to the login page."),e.location="/accounts/login/"),a.searchTerm="",a.siteEditDirections=f.trustAsHtml(g.get("siteCreateDirections")),a.siteEditDefinitions=f.trustAsHtml(g.get("siteEditDefinitions")),a.title="Creating A New Site",map.showMap(!0),a.sites=[],a.site={};var i,j,k=!1;void 0===b.siteId?(i=null,k=!0,j={id:"",type:"Feature",geometry:{},properties:{}}):i=parseInt(b.siteId,10),d.activeSiteId=i,h.getSites().then(function(){if(a.sites=h.sites.features,map.clear(),k)map.loadSites({type:"FeatureCollection",features:[]}),map.addSite(j);else{for(var b=h.sites.features.length-1;b>=0;b--){var c=h.sites.features[b];c.id===i&&(a.site=c,a.title='Editing <span class="label label-info">'+c.properties.name+"</span>",a.siteEditDirections=f.trustAsHtml(g.get("siteEditDirections")))}map.loadSites({type:"FeatureCollection",features:[a.site]}),map.editSite()}map.showMap(!0)}),a.$on("activeFeatureWKT",function(b,c){a.site.geometry=c}),a.save=function(){console.log("spinner on");try{var b=map.getActiveSiteWkt();k?h.postSite(a.site,b).then(function(){console.log("spinner off (POST new location complete!)"),c.path("/sites")}):h.putSite(a.site,b).then(function(){console.log("spinner off (PUT existing location complete!)"),c.path("/sites")})}catch(d){console.log(d),e.alert("Please draw the boundaries for your site.")}},a.geosearch=function(a){h.geosearch(a)}}]);var map;angular.module("uiApp").controller("PiteditCtrl",["$scope","$routeParams","$rootScope","$location","$window","$sce","ContentFactory","SiteFactory",function(a,b,c,d,e,f,g,h){c.userName||(e.alert("You are not logged in. You will now be redirected to the login page."),e.location="/accounts/login/"),map.showMap(!0),a.pitEditDirections=f.trustAsHtml(g.get("pitEditDirections"));var i=parseInt(b.siteId,10);c.activeSiteId=i,a.activePitId=!1;var j,k=!1,l={contamination:.75,adjacent_river_depth:.75,slope_dist:.9,pit_levies:.85,bank_slope:.75,surface_area:.5};a.pitFormObj={form:[{question:"Name",visible:!0,id:"name",order:0,type:"text",answers:[]},{question:"Is hazardous waste present?",visible:!0,id:"contamination",order:10,type:"select",answers:[{label:"I don't know",value:l.contamination},{label:"No, definitely not.",value:1},{label:"No, I don’t think so",value:.8},{label:"Yes, and the cost and effort to remediate it is acceptable.",value:.7},{label:"Yes, but I do not know if it can be remediated.",value:.5},{label:"Yes, and it will be expensive and/or very difficult to remediate.",value:0}]},{question:"Is the pit more than twice as deep as the adjacent river <u><i>thalweg</i></u>?",visible:!0,id:"adjacent_river_depth",order:30,type:"select",answers:[{label:"I don't know",value:l.adjacent_river_depth},{label:"No",value:1},{label:"They are the same depth",value:.7},{label:"Yes",value:0}],info:"The thalweg of the river is the line of the lowest points within the channel, spanning the length of the river."},{question:"What is the distance from the river to the pit edge?",visible:!0,id:"slope_dist",order:40,type:"select",answers:[{label:"I don't know",value:l.slope_dist},{label:"Short (< 250 ft.)",value:1},{label:"Medium (250-1000 ft.)",value:.6},{label:"Long (> 1000 ft.)",value:0}]},{question:"Are there any pit-adjacent levees?",visible:!0,id:"pit_levies",order:50,type:"select",answers:[{label:"I don't know",value:l.pit_levies},{label:"No",value:1},{label:"Yes",value:0}]},{question:"Select the answer that best describes the slope of the pit bank:",visible:!0,id:"bank_slope",order:70,type:"select",answers:[{label:"I don't know",value:l.bank_slope},{label:"The bank slope is very shallow around most of the pit.",value:1},{label:"The bank slope is a mix of steep and shallow.",value:.7},{label:"The bank slope is steep around most of the pit.",value:0}]},{question:"What is the surface area of the pit?",visible:!1,id:"surface_area",order:90,type:"select",answers:[{label:"< 5 acres",value:1},{label:"5-20 acres",value:.6},{label:"20-30 acres",value:.3},{label:"> 30 acres",value:0}]},{question:"Notes",visible:!0,id:"notes",order:110,type:"textarea",answers:[]}]},void 0===b.pitId?(a.pitEditDirections=f.trustAsHtml(g.get("pitCreateDirections")),k=!0,j={id:"",type:"Feature",geometry:{},properties:{notes:"",name:"<new pit>",site:i,contamination:l.contamination,adjacent_river_depth:l.adjacent_river_depth,slope_dist:l.slope_dist,pit_levies:l.pit_levies,bank_slope:l.bank_slope,surface_area:l.surface_area}}):a.activePitId=parseInt(b.pitId,10),a.pit={},a.site={},a.sites=[],h.getSites().then(function(){a.sites=h.sites.features;for(var b=h.sites.features.length-1;b>=0;b--){var c=h.sites.features[b];c.id===i&&(a.site=c)}if(map.clear(),map.loadSites({type:"FeatureCollection",features:[a.site]}),map.loadOtherPits({type:"FeatureCollection",features:a.site.properties.pit_set}),k)a.pit=j,map.loadPits({type:"FeatureCollection",features:[]}),map.addPit();else{for(var d=a.site.properties.pit_set.length-1;d>=0;d--){var e=a.site.properties.pit_set[d];e.id===a.activePitId&&(a.pit=e)}map.loadPits({type:"FeatureCollection",features:[a.pit]}),map.editPit()}map.showMap(!0)});var m=!1;("new"===b.pitId||null===a.pit)&&(m=!0,a.pit={id:"",type:"Feature",geometry:{},properties:{}}),a.$on("activeFeatureWKT",function(b,c){a.pit.geometry=c}),a.setPitArea=function(a){var b=map.getActivePitArea(),c=.5;5>=b?c=1:b>5&&20>=b?c=.6:b>20&&30>=b?c=.3:b>30&&(c=0),a.properties.surface_area=c},a.save=function(){try{var b=map.getActivePitWkt;a.setPitArea(a.pit),k?h.postSitePit(i,a.pit,b()).then(function(){d.path("/site/"+i)}):h.putSitePit(i,a.pit,map.getActivePitWkt()).then(function(){d.path("/site/"+i)})}catch(c){console.log(c),e.alert("No Pit Drawn")}}}]);var map;angular.module("uiApp").controller("SurveyCtrl",["$scope","$routeParams","$rootScope","$location","$window","SiteFactory","QuestionFactory","NodeFactory",function(a,b,c,d,e,f,g,h){c.userName||(alert("You are not logged in. You will now be redirected to the login page."),e.location="/accounts/login/"),map.showMap(!0);var i=parseInt(b.questionId,10);c.activeSiteId=b.siteId;var j=[];a.question={},a.numQuestions=j.length;var k=0,l=[];a.node={notes:"",site:c.activeSiteId,question:i,value:null},a.numNodes=0,a.nodeVal=null,a.nodeNotes=null,a.newNode=!0,a.hasExternalLink=!1,a.hasDownload=!1,a.hasImage=!1,g.getQuestions().then(function(){j=g.questions,a.numQuestions=j.length,a.question=j[i-1],a.question.displayId=i,a.node.question=a.question.id,null!==a.question.externalLink&&""!=a.question.externalLink&&(a.hasExternalLink=!0),""!==a.question.supplement&&(a.hasDownload=!0),""!==a.question.image&&(a.hasImage=!0),map.showMap(!0),h.getNodes(c.activeSiteId).then(function(){l=h.nodes,a.numNodes=l.length;for(var b=h.nodes.length-1;b>=0;b--){var d=h.nodes[b];d.question===a.question.id&&d.site===parseInt(c.activeSiteId,10)&&(a.node=d,a.nodeVal=d.value,a.nodeNotes=d.notes,a.newNode=!1)}map.showMap(!0)})}),a.showPrev=!0,a.submitForm=function(){for(var b=!1,c=document.getElementById("pitForm").elements,d=0;d<c.length;d++)"radio"===c[d].type&&c[d].checked&&(b=!0);b&&(a.node.value=a.nodeVal,a.node.notes=a.nodeNotes,a.newNode?h.postNode(a.node).then(function(b){a.newNode=!1,a.node.id=b.data.id,a.numNodes+=1}):h.putNode(a.node))},a.nextQuestion=function(){var b=i+1;d.path(b>a.numQuestions?"site/"+c.activeSiteId+"/survey/done":"site/"+c.activeSiteId+"/survey/"+b)},a.prevQuestion=function(){var b=i-1;return a.showPrev=!0,k>b&&(b=k,a.showPrev=!1),b},a.toggleCircleIconClass=function(a){var b=document.getElementById(a);b.className=b.classList.contains("glyphicon-plus-sign")?b.className.replace(/\bglyphicon-plus-sign\b/,"glyphicon-minus-sign"):b.className.replace(/\bglyphicon-minus-sign\b/,"glyphicon-plus-sign")}}]);var map,d3;angular.module("uiApp").controller("SurveydoneCtrl",["$scope","$routeParams","$rootScope","$window","SiteFactory","QuestionFactory",function(a,b,c,d,e,f){c.userName||(d.alert("You are not logged in. You will now be redirected to the login page."),d.location="/accounts/login/"),map.showMap(!0);var g=[];c.activeSiteId=b.siteId,e.getSuitabilityScores(b.siteId).then(function(){c.suitability=e.suitability;var a=[],b={low:{minScore:0,maxScore:33,label:"Unsuitable","class":"unsuitable"},med:{minScore:33,maxScore:66,label:"Moderately Suitable","class":"moderately-suitable"},high:{minScore:66,maxScore:100,label:"Highly Suitable","class":"highly-suitable"}},d={site:"Site",socio_economic:"Socio-Economic",landscape:"Landscape",suitability:"Overall"};for(var f in d)a.push({key:f,value:Math.floor(100*e.suitability[f])});var g=d3.select(".suitability-scores").selectAll("div").data(a).enter().append("div").attr("class","suitability-score"),h=g.append("p");h.append("span").attr("class","suitability-label").text(function(a){return d[a.key]+": "}),h.append("span").attr("class","suitability-rank").text(function(a){for(var c in b){var d=b[c];if(a.value<=d.maxScore&&a.value>=d.minScore)return d.label}return console.log("no label for "+a.key),null
}),g.append("div").attr("class",function(a){for(var c in b){var d=b[c];if(a.value<=d.maxScore&&a.value>=d.minScore)return"suitability-bar "+d["class"]}return"suitability-bar"}).style("width",function(a){return a.value+"%"}).text(function(a){return a.value})}),a.maxQuestionId=2,f.getQuestions().then(function(){g=f.questions,a.numQuestions=g.length,a.maxQuestionId=g.length,map.showMap(!0)}),a.alert=function(a){d.alert(a)}}]);var map;angular.module("uiApp").controller("ReportCtrl",["$scope","$rootScope","$window","$location","$routeParams","SiteFactory","QuestionFactory","NodeFactory",function(a,b,c,d,e,f,g,h){function i(){if(a.contextResponse&&a.categoryResponse&&a.questionResponse){a.contextList=[];var c=[{name:"Suitability",id:4,label:"Overall",components:[],order:0}];a.contextResponse=c.concat(a.contextResponse),a.contexts={Suitability:{id:4,label:"Overall",components:[]}};for(var d={},e=0;e<a.contextResponse.length;e++)d[a.contextResponse[e].id.toString()]=a.contextResponse[e].name,a.contexts[a.contextResponse[e].name]=a.contextResponse[e],a.contexts[a.contextResponse[e].name].components=[],a.contexts[a.contextResponse[e].name].label=a.suitabilityScoreTypes[a.contextResponse[e].name],a.contextList.push(a.contextResponse[e].name);for(var g={},i=0;i<a.questionResponse.length;i++){var j=a.questionResponse[i],k=j.questionCategory.toString();g.hasOwnProperty(k)||(g[k]=[]),g[k].push(j.id)}for(var m=0;m<a.categoryResponse.length;m++){var o=a.categoryResponse[m];o.question_ids=g[o.id.toString()];var p=d[o.context.toString()];a.contexts[p].components.push(o)}h.getNodes(b.activeSiteId).then(function(){n=h.nodes,a.numNodes=n.length;for(var c=0;c<n.length;c++){a.answers[n[c].question].value=n[c].value,a.answers[n[c].question].notes=n[c].notes;var d=a.answers[n[c].question].choices;for(var e in d)d[e].value===n[c].value&&(a.answers[n[c].question].answer=d[e].choice)}f.getSuitabilityScores(b.activeSiteId).then(function(){b.suitability=f.suitability,l()})})}}function j(a){for(var b in m){var c=m[b];if(a<=c.maxScore&&a>=c.minScore)return c.label}return null}function k(a){for(var b in m){var c=m[b];if(a<=c.maxScore&&a>=c.minScore)return c["class"]}return"transparent"}function l(){for(var c in a.suitabilityScoreTypes){var d=100*b.suitability[a.contextMap[c]];a.contexts[c].score=d,a.contexts[c].scoreDeg=2.25*d,a.contexts[c].rank=j(d),a.contexts[c].bgColorClass=k(d)}for(var e in a.pits)a.pits[e].properties.score.scoreDeg=225*a.pits[e].properties.score.value}map.showMap(!1),a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],b.activeSiteId=e.siteId,a.pits=[],a.answers={},a.userIsOwner=!1,a.siteSharedWithPublic=!1,a.currentUrl=d.$$absUrl;var m={low:{minScore:0,maxScore:33,label:"Unsuitable","class":"unsuitable"},med:{minScore:33,maxScore:66,label:"Moderately Suitable","class":"moderately-suitable"},high:{minScore:66,maxScore:100,label:"Highly Suitable","class":"highly-suitable"}};a.suitabilityScoreTypes={Site:"Location","Socio-Economic":"Socio-Economic",Landscape:"Landscape",Suitability:"Overall"},a.contextMap={Site:"site","Socio-Economic":"socio_economic",Landscape:"landscape",Suitability:"suitability"},g.getContexts().then(function(){a.contextResponse=g.contexts,i()}),g.getCategories().then(function(){a.categoryResponse=g.categories,i()}),f.getSites().then(function(){a.sites=f.sites.features;for(var e=f.sites.features.length-1;e>=0;e--){var g=f.sites.features[e];if(g.id===parseInt(b.activeSiteId,10)){a.site=g,a.pits=g.properties.pit_set;break}}a.site&&(a.userIsOwner=a.site.properties.user===b.userName,a.siteSharedWithPublic=a.site.properties.shared_with_public),a.userIsOwner||a.siteSharedWithPublic||(c.alert("You do not have permission to view this report. Be sure that you are the owner of this site or that the owner has made this report public."),d.path(b.userName?"sites":"/")),buildMap(g.geometry,g.properties.pit_set)});var n=[];g.getQuestions().then(function(){a.questionResponse=g.questions,a.numQuestions=a.questionResponse.length,a.maxQuestionId=a.questionResponse[a.questionResponse.length-1].id;for(var b=0;b<a.questionResponse.length;b++)a.answers[a.questionResponse[b].id]=a.questionResponse[b],a.answers[a.questionResponse[b].id].value=!1,a.answers[a.questionResponse[b].id].notes=!1,a.answers[a.questionResponse[b].id].answer=!1,a.answers[a.questionResponse[b].id].displayId=b+1;i(),map.showMap(!1)}),a.alert=function(a){c.alert(a)},a.toggleCircleIconClass=function(a){var b=document.getElementById(a);b.className=b.classList.contains("glyphicon-chevron-down")?b.className.replace(/\bglyphicon-chevron-down\b/,"glyphicon-chevron-up"):b.className.replace(/\bglyphicon-chevron-up\b/,"glyphicon-chevron-down")},a.toggleImpactIconClass=function(a){var b=document.getElementById(a);b.className=b.classList.contains("glyphicon-chevron-right")?b.className.replace(/\bglyphicon-chevron-right\b/,"glyphicon-chevron-left"):b.className.replace(/\bglyphicon-chevron-left\b/,"glyphicon-chevron-right")},a.selectComponent=function(a){var b=document.getElementById(a);b.className=b.classList.contains("report-component-selected")?b.className.replace(/\breport-component-selected\b/,""):b.className+" report-component-selected"},a.makePublic=function(b){f.publicizeSite(a.site,b).then(function(){c.location.reload()})}}]);var map;angular.module("uiApp").controller("HelpCtrl",["$scope","$routeParams","$rootScope","$sce",function(a,b,c){a.topic=b.topic,c.activeSiteId=null,map.showMap(!1)}]),angular.module("uiApp").controller("NavCtrl",["$scope","$rootScope","$window","$location","SiteFactory","QuestionFactory",function(a,b,c,d,e,f){a.sites=[],a.site={properties:{name:null}},b.$watch("activeSiteId",function(){a.site={properties:{name:null}},b.userName&&e.getSites().then(function(){a.sites=e.sites.features;for(var c=e.sites.features.length-1;c>=0;c--){var d=e.sites.features[c];d.id===parseInt(b.activeSiteId,10)&&(a.site=d)}})}),a.questions=[],a.questionsObj={},a.contexts=[],a.contextsObj={};var g={};f.getContexts().then(function(){a.contexts=f.contexts,f.getCategories().then(function(){a.categories=f.categories,f.getQuestions().then(function(){a.questions=f.questions;for(var b in a.questions){var c=a.questions[b];c.surveyNumber=parseInt(b,10),a.questionsObj[c.id.toString()]=c,g.hasOwnProperty(c.questionCategory.toString())||(g[c.questionCategory.toString()]=[]),g[c.questionCategory.toString()].push({id:c.id,surveyId:c.surveyNumber+1})}var d={};for(var e in a.categories){var h=a.categories[e];d.hasOwnProperty(h.context.toString())||(d[h.context.toString()]=[]),d[h.context.toString()].push({id:h.id,name:h.name,question_ids:g[h.id.toString()]})}for(var i in a.contexts){var j=a.contexts[i.toString()];a.contextsObj[j.name]={id:j.id,label:j.name,order:j.order,components:d[j.id.toString()]}}a.contextsList=[];for(var k in a.contextsObj){var l=a.contextsObj[k];a.contextsList[l.order]=l}for(var m=a.contextsList.length-1;m>=0;m--)void 0===a.contextsList[m]&&a.contextsList.splice(m,1)})})}),a.href=function(a){d.path(a)},a.link=function(a){c.location=a}}]),angular.module("uiApp").filter("digits",function(){return function(a){return 10>a&&(a="0"+a),a}}),angular.module("uiApp").filter("percentage",["$filter",function(a){return function(b,c){return a("number")(100*b,c)+"%"}}]);var map={site:{},pit:{},otherPit:{}};map.styleEditable=function(){return[new ol.style.Style({stroke:new ol.style.Stroke({color:"blue",width:2}),fill:new ol.style.Fill({color:"rgba(55, 55, 255, 0.4)"})})]},map.pit.style=function(){return[new ol.style.Style({stroke:new ol.style.Stroke({color:"white",width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 100, 0.1)"})})]},map.otherPit.style=function(){return[new ol.style.Style({stroke:new ol.style.Stroke({color:"orange",width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 100, 0.1)"})})]},map.site.style=function(){return[new ol.style.Style({stroke:new ol.style.Stroke({color:"white",lineDash:[4],width:2}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})]},map.loadSites=function(a){return a&&"FeatureCollection"===a.type?(map.map.removeLayer(map.site.layer),map.site.source=new ol.source.GeoJSON({object:a}),map.site.layer=new ol.layer.Vector({source:map.site.source,style:map.site.style}),map.map.addLayer(map.site.layer),void map.map.getView().fitExtent(map.site.source.getExtent(),map.map.getSize())):(console.log("ERROR in data supplied to map.loadSites:",a),!1)},map.loadPits=function(a){return a&&"FeatureCollection"===a.type?(map.map.removeLayer(map.pit.layer),map.pit.source=new ol.source.GeoJSON({object:a}),map.pit.layer=new ol.layer.Vector({source:map.pit.source,style:map.pit.style}),void map.map.addLayer(map.pit.layer)):(console.log("ERROR in data supplied to map.loadPits:",a),!1)},map.loadOtherPits=function(a){return a&&"FeatureCollection"===a.type?(map.map.removeLayer(map.otherPit.layer),map.otherPit.source=new ol.source.GeoJSON({object:a}),map.otherPit.layer=new ol.layer.Vector({source:map.otherPit.source,style:map.otherPit.style}),void map.map.addLayer(map.otherPit.layer)):(console.log("ERROR in data supplied to map.loadOtherPits:",a),!1)},map.clear=function(){map.map.removeInteraction(map.drawPit),map.map.removeInteraction(map.drawSite),map.map.removeInteraction(map.modifyPit),map.map.removeInteraction(map.modifySite),map.map.removeLayer(map.pit.layer),map.map.removeLayer(map.otherPit.layer),map.map.removeLayer(map.site.layer)},map.wktFormat=new ol.format.WKT,map.editSite=function(){map.modifySite=new ol.interaction.Modify({features:new ol.Collection(map.site.source.getFeatures()),deleteCondition:function(a){return ol.events.condition.shiftKeyOnly(a)&&ol.events.condition.singleClick(a)}}),map.map.addInteraction(map.modifySite),map.site.layer.setStyle(map.styleEditable)},map.editPit=function(){map.modifyPit=new ol.interaction.Modify({features:new ol.Collection(map.pit.source.getFeatures()),deleteCondition:function(a){return ol.events.condition.shiftKeyOnly(a)&&ol.events.condition.singleClick(a)}}),map.map.addInteraction(map.modifyPit),map.map.getView().fitExtent(map.pit.source.getExtent(),map.map.getSize()),map.pit.layer.setStyle(map.styleEditable)},map.addSite=function(){map.drawSite=new ol.interaction.Draw({source:map.site.source,type:"MultiPolygon"}),map.drawSite.on("drawstart",function(){map.site.source.clear()}),map.drawSite.on("drawend",function(){}),map.map.addInteraction(map.drawSite),map.site.layer.setStyle(map.styleEditable)},map.addPit=function(){map.drawPit=new ol.interaction.Draw({source:map.pit.source,type:"Polygon"}),map.drawPit.on("drawstart",function(){map.pit.source.clear()}),map.drawPit.on("drawend",function(){}),map.map.addInteraction(map.drawPit),map.pit.layer.setStyle(map.styleEditable)},map.getActiveSiteWkt=function(){var a=map.site.source.getFeatures(),b=a[0].getGeometry(),c=map.wktFormat.writeGeometry(b);return c},map.getActivePitWkt=function(){var a=map.pit.source.getFeatures(),b=a[0].getGeometry(),c=map.wktFormat.writeGeometry(b);return c},map.getActivePitArea=function(){var a=map.pit.source.getFeatures(),b=a[0].getGeometry(),c=b.getArea(),d=.0002471054*c;return.65*d};var mapQuestAttr=new ol.Attribution({html:"Source: MapQuest"});map.map=new ol.Map({target:"map",layers:[new ol.layer.Group({title:"Base maps",layers:[new ol.layer.Tile({visible:!0,title:"Satellite",type:"base",source:new ol.source.MapQuest({layer:"sat"})})]}),new ol.layer.Group({title:"Overlays",layers:[new ol.layer.Tile({title:"Street/Town Labels",visible:!0,source:new ol.source.MapQuest({layer:"hyb",attributions:[mapQuestAttr]})}),new ol.layer.Tile({title:"Dams",visible:!1,source:new ol.source.XYZ({attributions:[],url:"http://b.tiles.ecotrust.org/tiles/TNC_gravelpit_dams/{z}/{x}/{y}.png"})}),new ol.layer.Tile({title:"Barriers",visible:!1,source:new ol.source.XYZ({attributions:[],url:"http://b.tiles.ecotrust.org/tiles/TNC_gravelpit_barriers/{z}/{x}/{y}.png"})}),new ol.layer.Tile({title:"Protected Areas",visible:!1,source:new ol.source.XYZ({attributions:[],url:"http://b.tiles.ecotrust.org/tiles/TNC_gravelpit_protected/{z}/{x}/{y}.png"})}),new ol.layer.Tile({title:"100 Year Floodplain",visible:!1,opacity:.4,source:new ol.source.TileArcGISRest({attributions:[],url:"http://maps3.arcgisonline.com/ArcGIS/rest/services/A-16/FEMA_100-Year_Flood_Zones_in_the_USA/MapServer",params:{layers:"show:1"}})})]})],view:new ol.View({center:ol.proj.transform([-122,44],"EPSG:4326","EPSG:3857"),zoom:7})});var layerSwitcher=new ol.control.LayerSwitcher({});map.map.addControl(layerSwitcher);var scaleLine=new ol.control.ScaleLine({units:"us"});map.map.addControl(scaleLine),map.onResize=function(a){$(".map-container").height(a-51),map.map.updateSize()},$(window).resize(resize),$(document).ready(function(){window.setTimeout(resize,1)}),map.showMap=function(a){a?($("#map-container").show(),$("#left-container").removeClass("col-md-12"),$("#map-container").addClass("col-md-6"),$("#left-container").addClass("col-md-6"),$(".ol-top-container").css("visibility","visible")):($("#map-container").removeClass("col-md-6"),$("#map-container").hide(),$("#left-container").removeClass("col-md-6"),$("#left-container").addClass("col-md-12"),$(".ol-top-container").css("visibility","hidden"))};var geosearch=function(){var a=document.forms["map-geosearch-form"]["input-geosearch"].value;$.ajax({url:"/geosearch/search/?search="+a,success:function(a){map.geosearchZoom(a.extent)},error:function(a){window.alert('Unable to locate "'+a.responseJSON.search+'"')}})};map.geosearchZoom=function(a){map.map.getView().fitExtent(a,map.map.getSize())};var ol,rmap,site={},pits={},pitsGeoJson={type:"FeatureCollection",crs:{type:"name",properties:{name:"EPSG:3857"}},features:[]};angular.module("uiApp").factory("NodeFactory",["$http",function(a){var b={};return b.nodes=[],b.getNodes=function(c){var d=a.get("/api/node?format=json&site="+c);return d.success(function(a){b.nodes=a}),d.error(function(){console.log("Could not fetch questions.json")}),d},b.postNode=function(c){var d=a.post("/api/node",c);return d.success(function(a){b.status=a}),d.error(function(a){b.status=a,console.log("Could not create new node -- Error: "+a)}),d},b.putNode=function(c){var d=a.put("/api/node/"+c.id,c);return d.success(function(a){b.status=a}),d.error(function(a){b.status=a,console.log("Could not update node id: "+c.id+" -- Error: "+a)}),d},b}]);